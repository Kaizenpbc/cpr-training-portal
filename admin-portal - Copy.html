<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA CPR - Admin Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --background-color: #ecf0f1;
            --text-color: #2c3e50;
            --border-color: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .main-nav {
            display: flex;
            gap: 1rem;
        }

        .main-nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .main-nav a:hover {
            background-color: var(--secondary-color);
        }

        .main-nav a.active {
            background-color: var(--secondary-color);
        }

        .dashboard {
            padding: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .dashboard-title {
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .filter-section {
            background-color: white;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group label {
            color: var(--text-color);
            font-weight: bold;
        }

        .filter-group select {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-color);
        }

        .btn {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-reset {
            background-color: var(--accent-color);
        }

        .btn-reset:hover {
            background-color: #c0392b;
        }

        .btn-assign {
            background-color: var(--secondary-color);
        }

        .btn-confirm {
            background-color: #27ae60;
        }

        .btn-confirm:hover {
            background-color: #219a52;
        }

        .btn-bill {
            background-color: #f39c12;
        }

        .btn-bill:hover {
            background-color: #d68910;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            table-layout: fixed;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Add specific column widths */
        th:nth-child(1), td:nth-child(1) { width: 15%; } /* Name */
        th:nth-child(2), td:nth-child(2) { width: 10%; } /* Status */
        th:nth-child(3), td:nth-child(3) { width: 12%; } /* Date */
        th:nth-child(4), td:nth-child(4) { width: 18%; } /* Organization */
        th:nth-child(5), td:nth-child(5) { width: 15%; } /* Location */
        th:nth-child(6), td:nth-child(6) { width: 12%; } /* Class Type */
        th:nth-child(7), td:nth-child(7) { width: 10%; } /* Students Registered */
        th:nth-child(8), td:nth-child(8) { width: 8%; } /* Actions */

        thead {
            width: 100%;
            display: table;
            table-layout: fixed;
        }

        tbody {
            width: 100%;
            display: table;
            table-layout: fixed;
        }

        tr {
            width: 100%;
            display: table-row;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 2rem;
        }

        th.sortable:hover {
            background-color: #34495e;
        }

        th.asc::after {
            content: ' ↑';
        }

        th.desc::after {
            content: ' ↓';
        }

        tr:hover {
            background-color: var(--background-color);
        }

        .instructor-row {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        .date-status-row {
            background-color: white;
        }

        .nested-row td:first-child {
            padding-left: 30px;
        }

        .status-available {
            background-color: #2ecc71;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .status-scheduled {
            background-color: #f39c12;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .status-confirmed {
            background-color: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .status-complete {
            background-color: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .notes-cell {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        section {
            margin-bottom: 2rem;
        }

        section h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .dashboard {
                padding: 1rem;
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }

            table {
                font-size: 0.9rem;
            }

            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 500px;
        }

        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 4px;
            color: white;
            display: none;
            z-index: 1001;
        }

        .notification-success {
            background-color: #2ecc71;
        }

        .notification-error {
            background-color: #e74c3c;
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .btn-danger {
            background-color: #e74c3c;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        #resetDataModal ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        #resetDataModal p {
            margin: 10px 0;
        }

        .table-responsive td:last-child {
            text-align: center;
            white-space: nowrap;
        }

        .table-responsive .btn {
            display: inline-block;
            margin: 0;
            min-width: 80px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-success {
            background-color: #2ecc71;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        /* Add specific column widths for scheduled courses table */
        .table-responsive table th:nth-child(1), 
        .table-responsive table td:nth-child(1) { width: 10%; } /* System Date */
        .table-responsive table th:nth-child(2), 
        .table-responsive table td:nth-child(2) { width: 10%; } /* Course Date */
        .table-responsive table th:nth-child(3), 
        .table-responsive table td:nth-child(3) { width: 15%; } /* Organization */
        .table-responsive table th:nth-child(4), 
        .table-responsive table td:nth-child(4) { width: 12%; } /* Location */
        .table-responsive table th:nth-child(5), 
        .table-responsive table td:nth-child(5) { width: 12%; } /* Class Type */
        .table-responsive table th:nth-child(6), 
        .table-responsive table td:nth-child(6) { width: 8%; }  /* Students */
        .table-responsive table th:nth-child(7), 
        .table-responsive table td:nth-child(7) { width: 10%; } /* Status */
        .table-responsive table th:nth-child(8), 
        .table-responsive table td:nth-child(8) { width: 13%; } /* Instructor */
        .table-responsive table th:nth-child(9), 
        .table-responsive table td:nth-child(9) { width: 10%; } /* Actions */

        .table-responsive table {
            table-layout: fixed;
            width: 100%;
        }

        .table-responsive .btn {
            padding: 0.5rem 1rem;
            margin: 0;
            white-space: nowrap;
            min-width: 80px;
            display: inline-block;
        }

        .table-responsive td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0.75rem;
        }

        .table-responsive td:last-child {
            text-align: center;
            overflow: visible;
        }

        /* Add styles for truncated notes with tooltip */
        .note-cell {
            position: relative;
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: help;
        }

        .note-cell:hover::after {
            content: attr(data-full-note);
            position: absolute;
            left: 0;
            top: 100%;
            min-width: 200px;
            background-color: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            z-index: 1000;
            white-space: normal;
            max-width: 300px;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: fadeIn 0.2s ease-in-out;
            font-size: 14px;
            line-height: 1.4;
            margin-top: 5px;
        }

        .note-cell:hover::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 100%;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #2c3e50;
            margin-top: -3px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Update column widths for scheduled courses table to accommodate Notes */
        .table-responsive table th:nth-child(1), 
        .table-responsive table td:nth-child(1) { width: 8%; }  /* System Date */
        .table-responsive table th:nth-child(2), 
        .table-responsive table td:nth-child(2) { width: 8%; }  /* Course Date */
        .table-responsive table th:nth-child(3), 
        .table-responsive table td:nth-child(3) { width: 12%; } /* Organization */
        .table-responsive table th:nth-child(4), 
        .table-responsive table td:nth-child(4) { width: 10%; } /* Location */
        .table-responsive table th:nth-child(5), 
        .table-responsive table td:nth-child(5) { width: 10%; } /* Class Type */
        .table-responsive table th:nth-child(6), 
        .table-responsive table td:nth-child(6) { width: 8%; }  /* Students */
        .table-responsive table th:nth-child(7), 
        .table-responsive table td:nth-child(7) { width: 8%; }  /* Status */
        .table-responsive table th:nth-child(8), 
        .table-responsive table td:nth-child(8) { width: 12%; } /* Instructor */
        .table-responsive table th:nth-child(9), 
        .table-responsive table td:nth-child(9) { width: 14%; } /* Notes */
        .table-responsive table th:nth-child(10), 
        .table-responsive table td:nth-child(10) { width: 10%; } /* Actions */

        /* Add these styles to your existing CSS */
        .section {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section.active {
            display: block;
        }

        .left-nav {
            display: flex;
            flex-direction: row;
            gap: 10px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .left-nav button {
            padding: 8px 15px;
            border: none;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
            min-width: 120px;
            white-space: nowrap;
        }

        .left-nav button:hover {
            background: #e9ecef;
        }

        .left-nav button.active {
            background: var(--secondary-color);
            color: white;
        }

        .left-nav button.btn-danger {
            background: var(--accent-color);
            color: white;
        }

        .left-nav button.btn-danger:hover {
            background: #c0392b;
        }

        .main-content {
            flex: 1;
            padding: 20px;
        }

        .dashboard {
            display: flex;
            gap: 20px;
        }

        /* Add these styles to your existing CSS */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 5px;
            margin-top: 5px;
        }

        .stat-card {
            background: white;
            padding: 5px;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: var(--primary-color);
            margin-bottom: 2px;
            font-size: 0.8rem;
        }

        .stat-card p {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin: 0;
        }

        /* Add these styles to your existing CSS */
        .banner-box {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .banner-box h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .banner-box .nav-links {
            display: flex;
            gap: 1rem;
        }

        .banner-box .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .banner-box .nav-links a:hover {
            background-color: var(--secondary-color);
        }

        .banner-box .nav-links a.active {
            background-color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="logo">GTA CPR</div>
        <nav class="main-nav">
            <a href="Index.html">Home</a>
            <a href="instructor-portal.html">Instructors</a>
            <a href="organization-portal.html">Organizations</a>
            <a href="admin-portal.html" class="active">Admin</a>
            <a href="accounting-portal.html">Accounting</a>
        </nav>
    </header>

    <div style="background-color: white; padding: 20px; margin: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
        <h1 style="margin: 0; color: var(--primary-color); font-size: 2rem;">Admin Dashboard</h1>
    </div>

    <div class="dashboard">
        <nav class="left-nav">
            <button onclick="showSection('dashboard')">Dashboard</button>
            <button onclick="showSection('scheduledCourses')">Scheduled Courses</button>
            <button onclick="showSection('confirmedCourses')">Confirmed Courses</button>
            <button onclick="showSection('instructors')">Instructors</button>
            <button onclick="showSection('organizations')">Organizations</button>
            <button onclick="showSection('userManagement')">User Management</button>
            <button onclick="showSection('courseTypes')">Course Types</button>
            <button onclick="showSection('analytics')">Analytics</button>
            <button class="btn-danger" onclick="showResetDataConfirmation()">Reset All Data</button>
            <button onclick="handleLogout()">Logout</button>
        </nav>

        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section">
                <div style="display: flex; gap: 10px;">
                    <!-- Left side - Stats -->
                    <div style="flex: 2;">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <!-- Current Week Stats -->
                            <div style="flex: 1; background: white; padding: 10px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                <h3 style="color: var(--primary-color); margin: 0 0 5px 0; font-size: 0.8rem;">Current Week</h3>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px;">
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Scheduled</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="currentWeekScheduledCount">0</div>
                                    </div>
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Confirmed</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="currentWeekConfirmedCount">0</div>
                                    </div>
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Instructors</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="currentWeekInstructorCount">0</div>
                                    </div>
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Organizations</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="currentWeekOrganizationCount">0</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Next Week Stats -->
                            <div style="flex: 1; background: white; padding: 10px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                <h3 style="color: var(--primary-color); margin: 0 0 5px 0; font-size: 0.8rem;">Next Week</h3>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px;">
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Scheduled</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="nextWeekScheduledCount">0</div>
                                    </div>
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Confirmed</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="nextWeekConfirmedCount">0</div>
                                    </div>
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Instructors</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="nextWeekInstructorCount">0</div>
                                    </div>
                                    <div style="text-align: center; padding: 3px;">
                                        <div style="font-size: 0.7rem; color: #666;">Organizations</div>
                                        <div style="font-size: 1rem; font-weight: bold; color: var(--secondary-color);" id="nextWeekOrganizationCount">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right side - Monthly Instructor Summary -->
                    <div style="flex: 1; background: var(--primary-color); padding: 10px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                        <h3 style="color: white; margin: 0 0 5px 0; font-size: 0.8rem;">Monthly Summary</h3>
                        <div style="max-height: 100px; overflow-y: auto; background: rgba(255,255,255,0.1); border-radius: 4px; padding: 5px;">
                            <table style="width: 100%; font-size: 0.8rem; border-collapse: collapse; background: transparent;">
                                <thead>
                                    <tr>
                                        <th style="text-align: left; padding: 5px; color: white; border-bottom: 1px solid rgba(255,255,255,0.2);">Instructor</th>
                                        <th style="text-align: center; padding: 5px; color: white; border-bottom: 1px solid rgba(255,255,255,0.2);">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="monthlyConfirmedCoursesTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Add User Management Section -->
            <section id="userManagement" class="section">
                <h2>User Management</h2>
                <div class="table-container">
                    <div class="table-header">
                        <h3>System Users</h3>
                        <button class="btn btn-primary" onclick="showAddUserModal()">Add New User</button>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="userManagementTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Add User Modal -->
            <div id="addUserModal" class="modal">
                <div class="modal-content">
                    <h2>Add New User</h2>
                    <form onsubmit="handleAddUser(event)">
                        <div class="form-group">
                            <label for="newUsername">Username:</label>
                            <input type="text" id="newUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Password:</label>
                            <input type="password" id="newPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="userRole">Role:</label>
                            <select id="userRole" required>
                                <option value="">Select Role</option>
                                <option value="admin">Admin</option>
                                <option value="instructor">Instructor</option>
                                <option value="organization">Organization</option>
                                <option value="accounting">Accounting</option>
                            </select>
                        </div>
                        <div class="modal-buttons">
                            <button type="submit" class="btn btn-primary">Add User</button>
                            <button type="button" class="btn btn-secondary" onclick="closeModal('addUserModal')">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Instructor Dashboard -->
            <section id="instructorDashboard">
                <h2>Instructor Dashboard</h2>
                <div class="filters-section">
                    <div class="form-group">
                        <label for="dateFilter">Date:</label>
                        <input type="date" id="dateFilter">
                    </div>
                    <div class="form-group">
                        <label for="instructorFilter">Instructor:</label>
                        <select id="instructorFilter">
                            <option value="">All Instructors</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="organizationFilter">Organization:</label>
                        <select id="organizationFilter">
                            <option value="">All Organizations</option>
                        </select>
                    </div>
                    <!-- Add Quick Status Filter -->
                    <div class="form-group">
                        <label for="quickStatusFilter">Status:</label>
                        <select id="quickStatusFilter" onchange="filterTables()">
                            <option value="">All Statuses</option>
                            <option value="Available">Available</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="Confirmed">Confirmed</option>
                        </select>
                    </div>
                    <!-- Add Search Bar -->
                    <div class="form-group">
                        <label for="searchInput">Search:</label>
                        <input type="text" id="searchInput" placeholder="Search instructors, organizations..." oninput="filterTables()">
                    </div>
                    <!-- Add Bulk Actions -->
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="confirmSelectedCourses()">Confirm Selected</button>
                    </div>
                </div>
                <div class="filter-section">
                    <div class="filter-group">
                        <label for="statusFilter">Status:</label>
                        <select id="statusFilter">
                            <option value="">All</option>
                            <option value="Available">Available</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="Confirmed">Confirmed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn btn-reset" onclick="resetFilters()">Reset Filters</button>
                        <button class="btn btn-danger" onclick="showResetDataConfirmation()">Reset All Data</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="instructorTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('instructorTable', 0)">Name</th>
                                <th onclick="sortTable('instructorTable', 1)">Status</th>
                                <th onclick="sortTable('instructorTable', 2)">Date</th>
                                <th onclick="sortTable('instructorTable', 3)">Organization</th>
                                <th onclick="sortTable('instructorTable', 4)">Location</th>
                                <th onclick="sortTable('instructorTable', 5)">Class Type</th>
                                <th onclick="sortTable('instructorTable', 6)">Students Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="instructorTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Scheduled Courses -->
            <section id="scheduledCourses" class="section">
                <h2>Scheduled Courses</h2>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>System Date</th>
                                <th>Course Date</th>
                                <th>Organization</th>
                                <th>Location</th>
                                <th>Class Type</th>
                                <th>Students Registered</th>
                                <th>Status</th>
                                <th>Instructor</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="scheduledCoursesTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Confirmed Courses -->
            <section id="confirmedCourses" class="section">
                <h2>Confirmed Courses</h2>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>System Date</th>
                                <th>Course Date</th>
                                <th>Organization</th>
                                <th>Location</th>
                                <th>Class Type</th>
                                <th>Students Registered</th>
                                <th>Students Attended</th>
                                <th>Status</th>
                                <th>Instructor</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="confirmedCoursesTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Notification Element -->
            <div id="notification" class="notification"></div>

            <!-- Assign Instructor Modal -->
            <div id="assignInstructorModal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeModal('assignInstructorModal')">&times;</span>
                    <h3>Assign Instructor</h3>
                    <div class="form-group">
                        <label for="instructorSelect">Select Instructor:</label>
                        <select id="instructorSelect" required>
                            <option value="">Choose an instructor...</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="assignInstructor()">Assign</button>
                </div>
            </div>

            <!-- Add Reset Data Confirmation Modal -->
            <div id="resetDataModal" class="modal">
                <div class="modal-content">
                    <h2>Reset All Data</h2>
                    <p>Warning: This will permanently delete all data including:</p>
                    <ul>
                        <li>All instructors and their availability</li>
                        <li>All organizations</li>
                        <li>All courses and schedules</li>
                        <li>All student lists</li>
                    </ul>
                    <p>This action cannot be undone. Are you sure you want to continue?</p>
                    <div class="modal-buttons">
                        <button class="btn btn-danger" onclick="resetAllData()">Yes, Reset All Data</button>
                        <button class="btn btn-secondary" onclick="closeModal('resetDataModal')">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Student List Modal -->
            <div id="studentListModal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeStudentListModal()">&times;</span>
                    <h3>Student List</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody id="studentListTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <section id="courseTypes" class="section">
                <h2>Course Type Management</h2>
                <div class="section-content">
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Course Type</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="courseTypesTableBody"></tbody>
                        </table>
                    </div>
                    <button class="btn btn-primary" onclick="showAddCourseTypeModal()">Add Course Type</button>
                </div>
            </section>

            <!-- Add Course Type Modal -->
            <div id="courseTypeModal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeModal('courseTypeModal')">&times;</span>
                    <h3 id="courseTypeModalTitle">Add Course Type</h3>
                    <form id="courseTypeForm" onsubmit="saveCourseType(event)">
                        <div class="form-group">
                            <label for="courseTypeName">Course Type Name:</label>
                            <input type="text" id="courseTypeName" required>
                        </div>
                        <div class="form-group">
                            <label for="courseTypeDescription">Description:</label>
                            <textarea id="courseTypeDescription" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="courseTypeStatus">Status:</label>
                            <select id="courseTypeStatus" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <input type="hidden" id="courseTypeId">
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Standardized course types configuration
        const COURSE_TYPES = {
            'BLS': 'Basic Life Support',
            'ACLS': 'Advanced Cardiac Life Support',
            'PALS': 'Pediatric Advanced Life Support',
            'CPR': 'Cardiopulmonary Resuscitation',
            'First Aid': 'First Aid',
            'AED': 'Automated External Defibrillator'
        };

        // Function to get course type options HTML
        function getCourseTypeOptions() {
            return Object.entries(COURSE_TYPES)
                .map(([value, label]) => `<option value="${value}">${value} - ${label}</option>`)
                .join('');
        }

        // Function to get course type label
        function getCourseTypeLabel(value) {
            return COURSE_TYPES[value] || value;
        }

        // Initialize data if not exists
        function initializeData() {
            // Initialize instructors if not exists
            if (!localStorage.getItem('instructors')) {
                localStorage.setItem('instructors', JSON.stringify([]));
            }

            // Initialize organizations if not exists
            if (!localStorage.getItem('organizations')) {
                localStorage.setItem('organizations', JSON.stringify([]));
            }

            // Initialize courses if not exists
            if (!localStorage.getItem('courses')) {
                localStorage.setItem('courses', JSON.stringify([]));
            }
        }

        // Call initialization on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded');
            
            // Initialize data
            console.log('Initializing data...');
            initializeData();
            
            console.log('Initializing filters...');
            initializeFilters();
            
            console.log('Initializing course types...');
            initializeCourseTypes();

            // Update all tables and stats
            console.log('Updating tables and stats...');
            updateInstructorTable();
            updateScheduledCourses();
            updateConfirmedCourses();
            updateCourseTypesTable();
            updateDashboardStats();
            updateMonthlyConfirmedCourses();

            // Show dashboard section by default
            console.log('Setting up section display...');
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.style.display = 'none');
            
            const dashboardSection = document.getElementById('dashboard');
            if (dashboardSection) {
                dashboardSection.style.display = 'block';
            }

            // Set active state for dashboard button
            const navButtons = document.querySelectorAll('.left-nav button');
            navButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('onclick').includes('dashboard')) {
                    button.classList.add('active');
                }
            });

            // Add periodic refresh
            setInterval(() => {
                updateInstructorTable();
                updateScheduledCourses();
                updateConfirmedCourses();
                updateDashboardStats();
                updateMonthlyConfirmedCourses();
            }, 5000);
        });

        function initializeFilters() {
            try {
                // Load instructors
                const instructors = JSON.parse(localStorage.getItem('instructors')) || [];
                console.log('Loaded instructors:', instructors);
                
                // Load organizations
                const organizations = JSON.parse(localStorage.getItem('organizations')) || [];
                console.log('Loaded organizations:', organizations);
                
                // Load courses
                const courses = JSON.parse(localStorage.getItem('courses')) || [];
                console.log('Loaded courses:', courses);
                
                // Populate instructor filters
                const instructorFilters = [
                    document.getElementById('instructorFilter'),
                    document.getElementById('instructorSelect')
                ];
                
                instructorFilters.forEach(filter => {
                    if (filter) {
                        filter.innerHTML = `
                            <option value="">All Instructors</option>
                            ${instructors.map(instructor => 
                                `<option value="${instructor.id}">${instructor.name}</option>`
                            ).join('')}
                        `;
                    }
                });
                
                // Populate organization filters
                const organizationFilters = [
                    document.getElementById('organizationFilter'),
                    document.getElementById('scheduledOrgFilter')
                ];
                
                organizationFilters.forEach(filter => {
                    if (filter) {
                        filter.innerHTML = `
                            <option value="">All Organizations</option>
                            ${organizations.map(org => 
                                `<option value="${org.id}">${org.name}</option>`
                            ).join('')}
                        `;
                    }
                });

                // Set date filters to blank (no default date)
                const dateFilters = [
                    document.getElementById('dateFilter'),
                    document.getElementById('scheduledDateFilter')
                ];
                
                dateFilters.forEach(filter => {
                    if (filter) {
                        filter.value = ''; // Set to blank instead of today's date
                    }
                });

                // Trigger initial table updates
                updateTables();
            } catch (error) {
                console.error('Error initializing filters:', error);
                safeShowNotification('Error loading filters', 'error');
            }
        }

        function updateTables() {
            updateInstructorTable();
            updateScheduledCourses();
            updateConfirmedCourses();
        }

        function updateInstructorTable() {
            const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
            const courses = JSON.parse(localStorage.getItem('courses') || '[]');
            const tableBody = document.getElementById('instructorTableBody');
            const selectedDate = document.getElementById('dateFilter').value;
            const selectedInstructor = document.getElementById('instructorFilter').value;
            const selectedOrganization = document.getElementById('organizationFilter').value;

            if (!tableBody) return;

            let rows = [];
            let hasRows = false;

            instructors.forEach(instructor => {
                if (selectedInstructor && instructor.id !== selectedInstructor) return;

                if (instructor.availability && instructor.availability.length > 0) {
                    instructor.availability.forEach(date => {
                        if (selectedDate && date !== selectedDate) return;

                        // Find if there's a course scheduled for this instructor on this date
                        const scheduledCourse = courses.find(course => 
                            course.instructorId === instructor.id && 
                            course.courseDate === date
                        );

                        let status = 'Available';
                        let organization = '-';

                        if (scheduledCourse) {
                            // Only show organization name in admin view
                            organization = scheduledCourse.organizationName;
                            // Use admin dashboard status for instructor table
                            status = scheduledCourse.adminInstructorDashStatus || 'Available';
                        }

                        rows.push(`
                            <tr>
                                <td>${instructor.name}</td>
                                <td><span class="status-${status.toLowerCase()}">${status}</span></td>
                                <td>${formatDate(date)}</td>
                                <td>${organization}</td>
                                <td>${scheduledCourse?.location || '-'}</td>
                                <td>${scheduledCourse?.classType || '-'}</td>
                                <td>${scheduledCourse?.studentsRegistered || 0}</td>
                                <td>
                                    ${status === 'Available' ? 
                                        `<button class="btn btn-primary" onclick="assignInstructor('${instructor.id}', '${date}')">Edit</button>` : 
                                        '-'
                                    }
                                </td>
                            </tr>
                        `);
                        hasRows = true;
                    });
                }
            });

            if (!hasRows) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8">No instructors found for the selected criteria</td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = rows.join('');
        }

        function assignInstructor(instructorId, date) {
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const course = courses.find(c => c.courseDate === date);
                
                if (course) {
                    course.instructorId = instructorId;
                    course.instructorName = instructorId;
                    course.adminInstructorDashStatus = 'Scheduled';
                    localStorage.setItem('courses', JSON.stringify(courses));
                    
                    updateInstructorTable();
                    showNotification('Instructor assigned successfully', 'success');
                } else {
                    showNotification('No course found for this date', 'error');
                }
            } catch (error) {
                console.error('Error assigning instructor:', error);
                showNotification('Error assigning instructor', 'error');
            }
        }

        function confirmInstructor(instructorId, date) {
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const course = courses.find(c => 
                    c.courseDate === date && 
                    c.instructorId === instructorId
                );
                
                if (course) {
                    course.status = 'Confirmed';
                    localStorage.setItem('courses', JSON.stringify(courses));
                    
                    updateInstructorTable();
                    updateScheduledCourses(); // Update both tables
                    showNotification('Instructor confirmed successfully', 'success');
                } else {
                    showNotification('No scheduled course found', 'error');
                }
            } catch (error) {
                console.error('Error confirming instructor:', error);
                showNotification('Error confirming instructor', 'error');
            }
        }

        function updateScheduledCourses() {
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                const tbody = document.getElementById('scheduledCoursesTableBody');
                
                if (!tbody) return;
                
                // Filter for courses that are not confirmed or completed
                const scheduledCourses = courses.filter(course => 
                    course.adminScheduledDashStatus !== 'Confirmed' && 
                    course.adminScheduledDashStatus !== 'Complete'
                );
                
                tbody.innerHTML = scheduledCourses.length ? 
                    scheduledCourses.map(course => {
                        const escapedNotes = (course.notes || '-').replace(/"/g, '&quot;');
                        const status = course.adminScheduledDashStatus || 'Pending';
                        
                        // Check if there are any available instructors for this course date
                        const hasAvailableInstructors = instructors.some(instructor => 
                            instructor.availability && 
                            instructor.availability.includes(course.courseDate)
                        );
                        
                        return `
                            <tr>
                                <td>${course.systemDate || '-'}</td>
                                <td>${formatDate(course.courseDate)}</td>
                                <td>${course.organizationName || '-'}</td>
                                <td>${course.location || '-'}</td>
                                <td>${course.classType || '-'}</td>
                                <td>${course.studentsRegistered || 0}</td>
                                <td><span class="status-${status.toLowerCase()}">${status}</span></td>
                                <td>${course.instructorName || 'Not Assigned'}</td>
                                <td class="note-cell" data-full-note="${escapedNotes}">${course.notes || '-'}</td>
                                <td>
                                    ${!course.instructorName ? 
                                        hasAvailableInstructors ? 
                                            `<button class="btn btn-primary" onclick="showAssignInstructorModal('${course.id}')">Assign</button>` :
                                            `<button class="btn btn-secondary" disabled>No Instructors Available</button>` :
                                        `<button class="btn btn-success" onclick="confirmCourse('${course.id}')">Confirm</button>`
                                    }
                                    <button class="btn btn-info" onclick="viewStudentList('${course.id}')">View Students</button>
                                </td>
                            </tr>
                        `;
                    }).join('') :
                    '<tr><td colspan="10" style="text-align: center;">No scheduled courses</td></tr>';
            } catch (error) {
                console.error('Error updating scheduled courses:', error);
                showNotification('Error updating scheduled courses', 'error');
            }
        }

        function updateConfirmedCourses() {
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const tbody = document.getElementById('confirmedCoursesTableBody');
                
                if (!tbody) return;
                
                // Filter for confirmed courses
                const confirmedCourses = courses.filter(course => 
                    course.adminScheduledDashStatus === 'Confirmed'
                );
                
                tbody.innerHTML = confirmedCourses.length ? 
                    confirmedCourses.map(course => {
                        const escapedNotes = (course.notes || '-').replace(/"/g, '&quot;');
                        const status = course.adminScheduledDashStatus || 'Confirmed';
                        return `
                            <tr>
                                <td>${course.systemDate || '-'}</td>
                                <td>${formatDate(course.courseDate)}</td>
                                <td>${course.organizationName || '-'}</td>
                                <td>${course.location || '-'}</td>
                                <td>${course.classType || '-'}</td>
                                <td>${course.studentsRegistered || 0}</td>
                                <td>${course.studentsAttended || 0}</td>
                                <td><span class="status-${status.toLowerCase()}">${status}</span></td>
                                <td>${course.instructorName || 'Not Assigned'}</td>
                                <td>
                                    <button class="btn btn-info" onclick="viewStudentList('${course.id}')">View Students</button>
                                </td>
                            </tr>
                        `;
                    }).join('') :
                    '<tr><td colspan="10" style="text-align: center;">No confirmed courses</td></tr>';
            } catch (error) {
                console.error('Error updating confirmed courses:', error);
                showNotification('Error updating confirmed courses', 'error');
            }
        }

        function editCourseType(courseTypeId) {
            try {
                const courseTypes = JSON.parse(localStorage.getItem('courseTypes') || '[]');
                const courseType = courseTypes.find(ct => ct.id === courseTypeId);

                if (courseType) {
                    document.getElementById('courseTypeModalTitle').textContent = 'Edit Course Type';
                    document.getElementById('courseTypeId').value = courseType.id;
                    document.getElementById('courseTypeName').value = courseType.name;
                    document.getElementById('courseTypeDescription').value = courseType.description;
                    document.getElementById('courseTypeStatus').value = courseType.status;
                    document.getElementById('courseTypeModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Error editing course type:', error);
                showNotification('Error editing course type', 'error');
            }
        }

        function deleteCourseType(courseTypeId) {
            if (!confirm('Are you sure you want to delete this course type? This action cannot be undone.')) {
                return;
            }

            try {
                let courseTypes = JSON.parse(localStorage.getItem('courseTypes') || '[]');
                courseTypes = courseTypes.filter(ct => ct.id !== courseTypeId);
                localStorage.setItem('courseTypes', JSON.stringify(courseTypes));
                updateCourseTypesTable();
                showNotification('Course type deleted successfully', 'success');
            } catch (error) {
                console.error('Error deleting course type:', error);
                showNotification('Error deleting course type', 'error');
            }
        }

        // Initialize course types if not exists
        function initializeCourseTypes() {
            try {
                let courseTypes = JSON.parse(localStorage.getItem('courseTypes'));
                if (!courseTypes || courseTypes.length === 0) {
                    courseTypes = [
                        {
                            id: 'ct_1',
                            name: 'BLS',
                            description: 'Basic Life Support',
                            status: 'active'
                        },
                        {
                            id: 'ct_2',
                            name: 'ACLS',
                            description: 'Advanced Cardiac Life Support',
                            status: 'active'
                        },
                        {
                            id: 'ct_3',
                            name: 'PALS',
                            description: 'Pediatric Advanced Life Support',
                            status: 'active'
                        },
                        {
                            id: 'ct_4',
                            name: 'CPR',
                            description: 'Cardiopulmonary Resuscitation',
                            status: 'active'
                        },
                        {
                            id: 'ct_5',
                            name: 'First Aid',
                            description: 'First Aid',
                            status: 'active'
                        },
                        {
                            id: 'ct_6',
                            name: 'AED',
                            description: 'Automated External Defibrillator',
                            status: 'active'
                        }
                    ];
                    localStorage.setItem('courseTypes', JSON.stringify(courseTypes));
                }
            } catch (error) {
                console.error('Error initializing course types:', error);
            }
        }

        // Date handling functions
        function formatDateForStorage(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDateForDisplay(dateString) {
            if (!dateString) return '-';
            const [year, month, day] = dateString.split('-');
            return `${month}/${day}/${year}`;
        }

        function getCurrentDate() {
            const now = new Date();
            return formatDateForStorage(now);
        }

        // Update user creation
        function createUser(userData) {
            try {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const newUser = {
                    ...userData,
                    id: 'user_' + Date.now(),
                    createdAt: getCurrentDate(),
                    lastLogin: null
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                return true;
            } catch (error) {
                console.error('Error creating user:', error);
                return false;
            }
        }

        // Update login tracking
        function updateLastLogin(userId) {
            try {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex === -1) return false;
                
                users[userIndex].lastLogin = getCurrentDate();
                localStorage.setItem('users', JSON.stringify(users));
                return true;
            } catch (error) {
                console.error('Error updating last login:', error);
                return false;
            }
        }

        // Update course completion display
        function formatCompletionDate(completedDate) {
            if (!completedDate) return 'Not completed';
            return formatDateForDisplay(completedDate);
        }

        // Update showSection function
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Show the selected section
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.style.display = 'block';
            }

            // Update active state in navigation
            const navButtons = document.querySelectorAll('.left-nav button');
            navButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('onclick').includes(sectionId)) {
                    button.classList.add('active');
                }
            });
        }

        function updateDashboardStats() {
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                const organizations = JSON.parse(localStorage.getItem('organizations') || '[]');

                // Get current and next week bounds
                const today = new Date();
                const currentWeek = getWeekBounds(today);
                const nextWeek = getWeekBounds(new Date(today.setDate(today.getDate() + 7)));

                // Filter courses for current week
                const currentWeekCourses = courses.filter(course => 
                    course.courseDate >= currentWeek.start && course.courseDate <= currentWeek.end
                );

                // Filter courses for next week
                const nextWeekCourses = courses.filter(course => 
                    course.courseDate >= nextWeek.start && course.courseDate <= nextWeek.end
                );

                // Filter instructors for current week
                const currentWeekInstructors = instructors.filter(instructor => 
                    instructor.availability?.some(date => 
                        date >= currentWeek.start && date <= currentWeek.end
                    )
                );

                // Filter instructors for next week
                const nextWeekInstructors = instructors.filter(instructor => 
                    instructor.availability?.some(date => 
                        date >= nextWeek.start && date <= nextWeek.end
                    )
                );

                // Update current week stats
                document.getElementById('currentWeekScheduledCount').textContent = 
                    currentWeekCourses.filter(course => course.adminScheduledDashStatus === 'Scheduled').length;
                
                document.getElementById('currentWeekConfirmedCount').textContent = 
                    currentWeekCourses.filter(course => course.adminScheduledDashStatus === 'Confirmed').length;
                
                document.getElementById('currentWeekInstructorCount').textContent = currentWeekInstructors.length;
                document.getElementById('currentWeekOrganizationCount').textContent = 
                    [...new Set(currentWeekCourses.map(course => course.organizationId))].length;

                // Update next week stats
                document.getElementById('nextWeekScheduledCount').textContent = 
                    nextWeekCourses.filter(course => course.adminScheduledDashStatus === 'Scheduled').length;
                
                document.getElementById('nextWeekConfirmedCount').textContent = 
                    nextWeekCourses.filter(course => course.adminScheduledDashStatus === 'Confirmed').length;
                
                document.getElementById('nextWeekInstructorCount').textContent = nextWeekInstructors.length;
                document.getElementById('nextWeekOrganizationCount').textContent = 
                    [...new Set(nextWeekCourses.map(course => course.organizationId))].length;

            } catch (error) {
                console.error('Error updating dashboard stats:', error);
            }
        }

        // Date formatting function
        function formatDate(dateString) {
            if (!dateString) return '-';
            const [year, month, day] = dateString.split('-');
            return `${month}/${day}/${year}`;
        }

        // Safe notification function
        function safeShowNotification(message, type = 'info') {
            try {
                const notification = document.getElementById('notification');
                if (notification) {
                    notification.textContent = message;
                    notification.className = `notification notification-${type}`;
                    notification.style.display = 'block';
                    
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 3000);
                }
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }

        function updateCourseTypesTable() {
            try {
                const courseTypes = JSON.parse(localStorage.getItem('courseTypes') || '[]');
                const tbody = document.getElementById('courseTypesTableBody');
                
                if (!tbody) return;
                
                tbody.innerHTML = courseTypes.length ? 
                    courseTypes.map(courseType => `
                        <tr>
                            <td>${courseType.name}</td>
                            <td>${courseType.description}</td>
                            <td><span class="status-${courseType.status}">${courseType.status}</span></td>
                            <td>
                                <button class="btn btn-primary" onclick="editCourseType('${courseType.id}')">Edit</button>
                                <button class="btn btn-danger" onclick="deleteCourseType('${courseType.id}')">Delete</button>
                            </td>
                        </tr>
                    `).join('') :
                    '<tr><td colspan="4" style="text-align: center;">No course types found</td></tr>';
            } catch (error) {
                console.error('Error updating course types table:', error);
                showNotification('Error updating course types table', 'error');
            }
        }

        // Add these helper functions at the beginning of your script section
        function getWeekBounds(date) {
            const curr = new Date(date);
            const first = curr.getDate() - curr.getDay(); // First day is the day of the month - the day of the week
            const last = first + 6; // last day is the first day + 6

            const firstDay = new Date(curr.setDate(first));
            const lastDay = new Date(curr.setDate(last));

            // Format dates to YYYY-MM-DD
            return {
                start: firstDay.toISOString().split('T')[0],
                end: lastDay.toISOString().split('T')[0]
            };
        }

        function showAssignInstructorModal(courseId) {
            try {
                console.log('Starting showAssignInstructorModal with courseId:', courseId);
                
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const course = courses.find(c => c.id === courseId);

                if (!course) {
                    console.log('Course not found');
                    showNotification('Course not found', 'error');
                    return;
                }

                console.log('Found course:', course);
                console.log('Checking for available instructors on date:', course.courseDate);

                // Filter available instructors for the course date
                const availableInstructors = instructors.filter(instructor => {
                    // First check if instructor has the date in their availability
                    const hasDate = instructor.availability && 
                        instructor.availability.includes(course.courseDate);
                    
                    if (!hasDate) {
                        console.log(`Instructor ${instructor.name} does not have date in availability`);
                        return false;
                    }

                    // Then check if instructor is already assigned to another course on this date
                    const isAlreadyAssigned = courses.some(c => 
                        c.courseDate === course.courseDate && 
                        c.instructorId === instructor.id &&
                        c.id !== courseId // Exclude current course
                    );

                    console.log(`Instructor ${instructor.name}: hasDate=${hasDate}, isAlreadyAssigned=${isAlreadyAssigned}`);
                    return hasDate && !isAlreadyAssigned;
                });

                console.log('Available instructors:', availableInstructors);

                // If no instructors are available, show notification and return
                if (!availableInstructors || availableInstructors.length === 0) {
                    console.log('No available instructors found');
                    showNotification(`No instructors available for ${formatDateForDisplay(course.courseDate)}`, 'error');
                    return; // Explicitly return here to prevent modal display
                }

                // Only proceed to open modal if we have available instructors
                const modal = document.getElementById('assignInstructorModal');
                const select = document.getElementById('instructorSelect');

                if (!modal || !select) {
                    console.log('Modal or select element not found');
                    showNotification('Error loading modal', 'error');
                    return;
                }

                // Populate instructor dropdown with only available instructors
                select.innerHTML = `
                    <option value="">Choose an instructor...</option>
                    ${availableInstructors.map(instructor => 
                        `<option value="${instructor.id}">${instructor.name}</option>`
                    ).join('')}
                `;

                modal.style.display = 'block';
                modal.dataset.courseId = courseId;
                console.log('Modal displayed successfully');
            } catch (error) {
                console.error('Error in showAssignInstructorModal:', error);
                showNotification('Error loading instructor data', 'error');
            }
        }

        // Update the notification function to ensure it's visible
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = message;
                notification.className = `notification notification-${type}`;
                notification.style.display = 'block';
                
                // Make sure the notification is visible
                notification.style.zIndex = '9999';
                notification.style.opacity = '1';
                
                // Hide after 3 seconds
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
        }

        // Update the monthly confirmed courses table function with detailed tracing
        function updateMonthlyConfirmedCourses() {
            try {
                console.log('Starting updateMonthlyConfirmedCourses');
                
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                console.log('Loaded courses:', courses);
                
                const tbody = document.getElementById('monthlyConfirmedCoursesTable');
                console.log('Found tbody element:', !!tbody);
                
                if (!tbody) {
                    console.log('No tbody element found, returning');
                    return;
                }

                // Get current month's date range
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                console.log('Date range:', {
                    firstDay: firstDay.toISOString(),
                    lastDay: lastDay.toISOString()
                });

                // Filter confirmed courses for current month
                const confirmedCourses = courses.filter(course => {
                    const courseDate = new Date(course.courseDate);
                    const isConfirmed = course.adminScheduledDashStatus === 'Confirmed';
                    const isInCurrentMonth = courseDate >= firstDay && courseDate <= lastDay;
                    console.log('Course:', {
                        id: course.id,
                        date: course.courseDate,
                        status: course.adminScheduledDashStatus,
                        isConfirmed,
                        isInCurrentMonth
                    });
                    return isConfirmed && isInCurrentMonth;
                });
                console.log('Filtered confirmed courses:', confirmedCourses);

                // Group courses by instructor and count them
                const instructorSummary = confirmedCourses.reduce((acc, course) => {
                    if (course.instructorName) {
                        acc[course.instructorName] = (acc[course.instructorName] || 0) + 1;
                    }
                    return acc;
                }, {});
                console.log('Instructor summary:', instructorSummary);

                // Convert to array and sort by total courses (descending)
                const sortedInstructors = Object.entries(instructorSummary)
                    .sort(([, a], [, b]) => b - a);
                console.log('Sorted instructors:', sortedInstructors);

                // Update the table with improved styling and contrast
                tbody.innerHTML = sortedInstructors.length ? 
                    sortedInstructors.map(([instructor, total]) => `
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                            <td style="padding: 8px 5px; color: white; white-space: nowrap; font-weight: 500; background: transparent;">${instructor}</td>
                            <td style="text-align: center; padding: 8px 5px; font-weight: bold; color: white; background: rgba(255,255,255,0.15); border-radius: 3px;">${total}</td>
                        </tr>
                    `).join('') :
                    '<tr><td colspan="2" style="text-align: center; padding: 15px 5px; color: white; font-style: italic; background: transparent;">No confirmed courses</td></tr>';
                
                console.log('Table updated successfully');
            } catch (error) {
                console.error('Error in updateMonthlyConfirmedCourses:', error);
            }
        }
    </script>
</body>
</html> 