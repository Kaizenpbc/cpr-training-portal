<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Management Test Portal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-section h2 {
            color: #444;
            margin-top: 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #console-output {
            background-color: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .clear-btn {
            background-color: #f44336;
        }
        .clear-btn:hover {
            background-color: #da190b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Course Management Test Portal</h1>
        
        <div class="test-section">
            <h2>Course Status Check</h2>
            <button onclick="checkCourseStatuses()" class="btn btn-success">Check Current Course Statuses</button>
            <button onclick="checkInstructorStatuses()" class="btn btn-success">Check Instructor Statuses</button>
        </div>

        <div class="test-section">
            <h2>Course Workflow Tests</h2>
            <button onclick="testInstructorAvailability()">Test Instructor Availability</button>
            <button onclick="testOrganizationSubmission()">Test Organization Submission</button>
            <button onclick="testAdminScheduling()">Test Admin Scheduling</button>
            <button onclick="testAdminConfirmation()">Test Admin Confirmation</button>
        </div>

        <div class="test-section">
            <h2>Test Controls</h2>
            <button onclick="clearTestData()" class="btn btn-danger">Clear Test Data</button>
            <button onclick="showCurrentData()" class="btn btn-info">Show Current Data</button>
            <button onclick="testInstructorAvailability()" class="btn btn-success">Test Instructor Availability</button>
            <button onclick="testOrganizationSubmission()" class="btn btn-success">Test Organization Submission</button>
        </div>

        <div class="test-section">
            <h2>Test Logins</h2>
            <button onclick="loginAsInstructor('test1')" class="btn btn-primary">Login as test1</button>
            <button onclick="loginAsOrganization('ORG1')" class="btn btn-primary">Login as ORG1</button>
        </div>

        <div class="test-section">
            <h2>Console Output</h2>
            <button class="clear-btn" onclick="clearConsole()">Clear Console</button>
            <div id="console-output"></div>
        </div>

        <div class="test-section">
            <h2>Debug Tools</h2>
            <button onclick="checkLocalStorageState()" class="btn btn-info">Check localStorage State</button>
            <button onclick="simulateOrgPortalFiltering()" class="btn btn-info">Simulate Org Portal Filtering</button>
        </div>
    </div>

    <script>
        // Override console.log to display in our console-output div
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const consoleOutput = document.getElementById('console-output');

        console.log = function() {
            originalConsoleLog.apply(console, arguments);
            const message = Array.from(arguments).join(' ');
            consoleOutput.innerHTML += `<div style="color: #fff;">${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        console.error = function() {
            originalConsoleError.apply(console, arguments);
            const message = Array.from(arguments).join(' ');
            consoleOutput.innerHTML += `<div style="color: #ff6b6b;">${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // Test Course Status Workflow
        function testCourseWorkflow() {
            console.log('Starting Course Workflow Tests...');
            
            // Test 1: Organization Submits Course
            function testOrganizationSubmission() {
                console.log('\nTest 1: Organization Course Submission');
                try {
                    // Create test organization
                    const testOrg = {
                        id: 'test_org_' + Date.now(),
                        name: 'Test Organization',
                        email: 'test@org.com'
                    };
                    localStorage.setItem('currentOrganization', JSON.stringify(testOrg));
                    
                    // Create test course
                    const testCourse = {
                        id: 'test_course_' + Date.now(),
                        date: '2024-04-01',
                        location: 'Test Location',
                        classType: 'Test Class',
                        studentsRegistered: '10',
                        notes: 'Test Notes',
                        status: 'PENDING',
                        adminScheduledDashStatus: 'PENDING',
                        adminInstructorDashStatus: 'PENDING',
                        organizationStatus: 'PENDING',
                        instructorStatus: 'AVAILABLE',
                        adminConfirmed: false,
                        displayInstructorDetails: false,
                        displayOrgDetails: false,
                        hideOrgDetails: true,
                        organization: testOrg,
                        instructorId: null,
                        instructorName: null
                    };
                    
                    // Add course to storage
                    const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                    courses.push(testCourse);
                    localStorage.setItem('courses', JSON.stringify(courses));
                    
                    // Verify initial status
                    const savedCourse = courses.find(c => c.id === testCourse.id);
                    if (savedCourse && 
                        savedCourse.status === 'PENDING' &&
                        savedCourse.instructorId === null &&
                        savedCourse.displayInstructorDetails === false) {
                        console.log('✓ Organization submission test passed');
                        return true;
                    } else {
                        console.error('✗ Organization submission test failed');
                        return false;
                    }
                } catch (error) {
                    console.error('Error in organization submission test:', error);
                    return false;
                }
            }
            
            // Test 2: Admin Schedules Course
            function testAdminScheduling() {
                console.log('\nTest 2: Admin Course Scheduling');
                try {
                    const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                    const testCourse = courses.find(c => c.instructorId === null);
                    
                    if (!testCourse) {
                        console.error('✗ No pending course found for scheduling test');
                        return false;
                    }
                    
                    // Create test instructor
                    const testInstructor = {
                        id: 'test_instructor_' + Date.now(),
                        name: 'Test2',
                        email: 'test2@instructor.com'
                    };
                    
                    // Update course with instructor
                    testCourse.instructorId = testInstructor.id;
                    testCourse.instructorName = testInstructor.name;
                    testCourse.adminInstructorDashStatus = 'SCHEDULED';
                    testCourse.displayOrgDetails = true;
                    testCourse.status = 'SCHEDULED';
                    testCourse.adminScheduledDashStatus = 'SCHEDULED';
                    testCourse.organizationStatus = 'PENDING';
                    testCourse.instructorStatus = 'AVAILABLE';
                    testCourse.displayInstructorDetails = false;
                    testCourse.hideOrgDetails = true;
                    
                    localStorage.setItem('courses', JSON.stringify(courses));
                    
                    // Verify scheduling status
                    const updatedCourse = courses.find(c => c.id === testCourse.id);
                    if (updatedCourse &&
                        updatedCourse.status === 'SCHEDULED' &&
                        updatedCourse.instructorId === testInstructor.id &&
                        updatedCourse.organizationStatus === 'PENDING' &&
                        updatedCourse.instructorStatus === 'AVAILABLE' &&
                        updatedCourse.displayInstructorDetails === false) {
                        console.log('✓ Admin scheduling test passed');
                        return true;
                    } else {
                        console.error('✗ Admin scheduling test failed');
                        return false;
                    }
                } catch (error) {
                    console.error('Error in admin scheduling test:', error);
                    return false;
                }
            }
            
            // Test 3: Admin Confirms Course
            function testAdminConfirmation() {
                console.log('\nTest 3: Admin Course Confirmation');
                try {
                    const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                    const testCourse = courses.find(c => c.status === 'SCHEDULED');
                    
                    if (!testCourse) {
                        console.error('✗ No scheduled course found for confirmation test');
                        return false;
                    }
                    
                    // Update course status to confirmed
                    testCourse.status = 'CONFIRMED';
                    testCourse.adminScheduledDashStatus = 'CONFIRMED';
                    testCourse.adminInstructorDashStatus = 'CONFIRMED';
                    testCourse.organizationStatus = 'CONFIRMED';
                    testCourse.instructorStatus = 'CONFIRMED';
                    testCourse.adminConfirmed = true;
                    testCourse.displayInstructorDetails = true;
                    testCourse.displayOrgDetails = true;
                    testCourse.hideOrgDetails = false;
                    testCourse.isConfirmed = true;
                    
                    localStorage.setItem('courses', JSON.stringify(courses));
                    
                    // Verify confirmation status
                    const updatedCourse = courses.find(c => c.id === testCourse.id);
                    if (updatedCourse &&
                        updatedCourse.status === 'CONFIRMED' &&
                        updatedCourse.adminConfirmed === true &&
                        updatedCourse.displayInstructorDetails === true &&
                        updatedCourse.displayOrgDetails === true &&
                        updatedCourse.hideOrgDetails === false) {
                        console.log('✓ Admin confirmation test passed');
                        return true;
                    } else {
                        console.error('✗ Admin confirmation test failed');
                        return false;
                    }
                } catch (error) {
                    console.error('Error in admin confirmation test:', error);
                    return false;
                }
            }
            
            // Run all tests
            const orgTest = testOrganizationSubmission();
            const scheduleTest = testAdminScheduling();
            const confirmTest = testAdminConfirmation();
            
            // Print summary
            console.log('\nTest Summary:');
            console.log('Organization Submission:', orgTest ? '✓ Passed' : '✗ Failed');
            console.log('Admin Scheduling:', scheduleTest ? '✓ Passed' : '✗ Failed');
            console.log('Admin Confirmation:', confirmTest ? '✓ Passed' : '✗ Failed');
            
            return orgTest && scheduleTest && confirmTest;
        }

        // Status check function
        function checkCourseStatuses() {
            console.log('\n=== Current Course Statuses ===');
            
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                
                if (courses.length === 0) {
                    console.log('No courses found in the system.');
                    return;
                }

                courses.forEach((course, index) => {
                    console.log(`\nCourse ${index + 1}:`);
                    console.log('ID:', course.id);
                    console.log('Date:', course.date);
                    console.log('Status:', course.status);
                    console.log('Admin Scheduled Status:', course.adminScheduledDashStatus);
                    console.log('Admin Instructor Status:', course.adminInstructorDashStatus);
                    console.log('Organization Status:', course.organizationStatus);
                    console.log('Instructor Status:', course.instructorStatus);
                    console.log('Admin Confirmed:', course.adminConfirmed);
                    console.log('Instructor ID:', course.instructorId || 'Not Assigned');
                    console.log('Instructor Name:', course.instructorName || 'Not Assigned');
                    console.log('Organization:', course.organization?.name || 'Not Set');
                    console.log('Display Flags:');
                    console.log('- Instructor Details:', course.displayInstructorDetails);
                    console.log('- Organization Details:', course.displayOrgDetails);
                    console.log('- Hide Org Details:', course.hideOrgDetails);
                    console.log('------------------------');
                });
            } catch (error) {
                console.error('Error checking course statuses:', error);
            }
        }

        // Add new function to test instructor availability
        function testInstructorAvailability() {
            console.log('\n=== Testing Instructor Availability ===');
            try {
                // Create test instructor
                const testInstructor = {
                    id: 'inst_test1',
                    username: 'test1',
                    firstName: 'Test',
                    lastName: 'One',
                    name: 'Test One',
                    email: 'test1@instructor.com',
                    status: 'ACTIVE',
                    availability: ['2024-04-01']  // Set initial availability
                };
                
                // Store instructor in instructors array
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                const filteredInstructors = instructors.filter(i => i.id !== testInstructor.id);
                filteredInstructors.push(testInstructor);
                localStorage.setItem('instructors', JSON.stringify(filteredInstructors));
                
                // Set as current instructor
                localStorage.setItem('currentInstructor', JSON.stringify(testInstructor));
                
                // Add availability record
                const availability = {
                    id: 'availability_' + Date.now(),
                    instructorId: testInstructor.id,
                    date: '2024-04-01',
                    available: true,
                    notes: 'Available for teaching',
                    status: 'AVAILABLE'
                };
                
                const availabilities = JSON.parse(localStorage.getItem('instructorAvailability') || '[]');
                const filteredAvailabilities = availabilities.filter(a => 
                    !(a.instructorId === testInstructor.id && a.date === availability.date)
                );
                filteredAvailabilities.push(availability);
                localStorage.setItem('instructorAvailability', JSON.stringify(filteredAvailabilities));
                
                console.log('Created test instructor:', testInstructor.username);
                console.log('Set availability for April 1st, 2024');
                console.log('\nYou can now:');
                console.log('1. Log into instructor portal with username: test1');
                console.log('2. View instructor in Admin Instructor Dashboard');
                
                return { success: true, message: 'Test instructor created and availability set' };
            } catch (error) {
                console.error('Error in testInstructorAvailability:', error);
                return { success: false, error: error.message };
            }
        }

        // Update organization submission test to show all portal statuses
        function testOrganizationSubmission() {
            console.log('\n=== Testing Organization Course Submission ===');
            try {
                // Create test organization
                const testOrg = {
                    id: 'org_test1',
                    name: 'ORG1',
                    username: 'ORG1',
                    email: 'org1@test.com',
                    status: 'ACTIVE'
                };
                
                // Store organization in organizations array and set as current
                const organizations = JSON.parse(localStorage.getItem('organizations') || '[]');
                const filteredOrganizations = organizations.filter(o => o.id !== testOrg.id);
                filteredOrganizations.push(testOrg);
                localStorage.setItem('organizations', JSON.stringify(filteredOrganizations));
                localStorage.setItem('currentOrganization', JSON.stringify(testOrg));
                
                // Create course submission
                const course = {
                    id: 'course_' + Date.now(),
                    courseDate: '2024-04-01',
                    location: 'Test Location',
                    classType: 'BLS',
                    studentsRegistered: '10',
                    notes: 'Test course submission',
                    status: 'PENDING',
                    adminScheduledDashStatus: 'PENDING',
                    adminInstructorDashStatus: 'PENDING',
                    organizationStatus: 'PENDING',
                    instructorStatus: 'PENDING',
                    adminConfirmed: false,
                    displayInstructorDetails: false,
                    displayOrgDetails: false,
                    hideOrgDetails: true,
                    organization: testOrg,
                    organizationName: testOrg.name,
                    instructorId: null,
                    instructorName: null
                };
                
                // Store course
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const filteredCourses = courses.filter(c => 
                    !(c.organization?.id === testOrg.id && c.courseDate === course.courseDate)
                );
                filteredCourses.push(course);
                localStorage.setItem('courses', JSON.stringify(filteredCourses));
                
                console.log('Created test organization:', testOrg.username);
                console.log('Submitted course for April 1st, 2024');
                console.log('\nYou can now:');
                console.log('1. Log into organization portal with username: ORG1');
                console.log('2. View submitted course in organization dashboard');
                console.log('3. View course in admin course management (status: PENDING)');
                
                return { success: true, message: 'Test organization created and course submitted' };
            } catch (error) {
                console.error('Error in testOrganizationSubmission:', error);
                return { success: false, error: error.message };
            }
        }

        // Update admin scheduling test to show all portal statuses
        function testAdminScheduling() {
            console.log('\n=== Testing Admin Course Scheduling ===');
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const testCourse = courses.find(c => c.instructorId === null);
                
                if (!testCourse) {
                    console.error('✗ No pending course found for scheduling test');
                    return false;
                }
                
                // Create test instructor
                const testInstructor = {
                    id: 'test_instructor_' + Date.now(),
                    name: 'Test2',
                    email: 'test2@instructor.com'
                };
                
                // Update course with instructor
                testCourse.instructorId = testInstructor.id;
                testCourse.instructorName = testInstructor.name;
                testCourse.adminInstructorDashStatus = 'SCHEDULED';
                testCourse.displayOrgDetails = true;
                testCourse.status = 'SCHEDULED';
                testCourse.adminScheduledDashStatus = 'SCHEDULED';
                testCourse.organizationStatus = 'PENDING';
                testCourse.instructorStatus = 'AVAILABLE';
                testCourse.displayInstructorDetails = false;
                testCourse.hideOrgDetails = true;
                
                localStorage.setItem('courses', JSON.stringify(courses));
                
                // Show status across portals
                console.log('\nStatus After Admin Schedules Course:');
                console.log('\n1. Organization Portal:');
                console.log('- Course Status: PENDING');
                console.log('- No instructor visible');
                console.log('- Organization can see their course');
                
                console.log('\n2. Admin Portal - Course Management:');
                console.log('- Course Status: SCHEDULED');
                console.log('- Instructor assigned and visible');
                console.log('- Organization details visible');
                
                console.log('\n3. Admin Portal - Scheduled Courses:');
                console.log('- Course Status: SCHEDULED');
                console.log('- Shows in SCHEDULED section');
                console.log('- Instructor details visible');
                
                console.log('\n4. Instructor Portal:');
                console.log('- Course not visible');
                console.log('- Status remains AVAILABLE');
                
                // After scheduling course, display all portal records
                displayAllPortalRecords();
                
                return true;
            } catch (error) {
                console.error('Error in admin scheduling test:', error);
                return false;
            }
        }

        // Update admin confirmation test to show all portal statuses
        function testAdminConfirmation() {
            console.log('\n=== Testing Admin Course Confirmation ===');
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const testCourse = courses.find(c => c.status === 'SCHEDULED');
                
                if (!testCourse) {
                    console.error('✗ No scheduled course found for confirmation test');
                    return false;
                }
                
                // Update course status to confirmed
                testCourse.status = 'CONFIRMED';
                testCourse.adminScheduledDashStatus = 'CONFIRMED';
                testCourse.adminInstructorDashStatus = 'CONFIRMED';
                testCourse.organizationStatus = 'CONFIRMED';
                testCourse.instructorStatus = 'CONFIRMED';
                testCourse.adminConfirmed = true;
                testCourse.displayInstructorDetails = true;
                testCourse.displayOrgDetails = true;
                testCourse.hideOrgDetails = false;
                testCourse.isConfirmed = true;
                
                localStorage.setItem('courses', JSON.stringify(courses));
                
                // Show status across portals
                console.log('\nStatus After Admin Confirms Course:');
                console.log('\n1. Organization Portal:');
                console.log('- Course Status: CONFIRMED');
                console.log('- Instructor details visible');
                console.log('- Organization can see their course');
                
                console.log('\n2. Admin Portal - Course Management:');
                console.log('- Course Status: CONFIRMED');
                console.log('- Instructor details visible');
                console.log('- Organization details visible');
                
                console.log('\n3. Admin Portal - Scheduled Courses:');
                console.log('- Course Status: CONFIRMED');
                console.log('- Moved to CONFIRMED section');
                console.log('- All details visible');
                
                console.log('\n4. Instructor Portal:');
                console.log('- Course Status: CONFIRMED');
                console.log('- Organization details visible');
                console.log('- Course appears in confirmed section');
                
                // After confirming course, display all portal records
                displayAllPortalRecords();
                
                return true;
            } catch (error) {
                console.error('Error in admin confirmation test:', error);
                return false;
            }
        }

        // Add new function to display all portal records
        function displayAllPortalRecords() {
            console.log('\n=== Current State of All Portals ===');
            
            // Display Instructor Portal Records
            console.log('\n1. Instructor Portal Records:');
            try {
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                const availabilities = JSON.parse(localStorage.getItem('instructorAvailability') || '[]');
                
                instructors.forEach(instructor => {
                    console.log(`\nInstructor: ${instructor.firstName} ${instructor.lastName}`);
                    const instructorAvailabilities = availabilities.filter(a => a.instructorId === instructor.id);
                    if (instructorAvailabilities.length > 0) {
                        console.log('Availability:');
                        instructorAvailabilities.forEach(avail => {
                            console.log(`- Date: ${avail.date}, Status: ${avail.status}`);
                        });
                    } else {
                        console.log('No availability records');
                    }
                });
            } catch (error) {
                console.error('Error displaying instructor portal records:', error);
            }

            // Display Admin Portal Records
            console.log('\n2. Admin Portal Records:');
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                console.log('\nCourse Management:');
                courses.forEach(course => {
                    console.log(`\nCourse ID: ${course.id}`);
                    console.log(`Date: ${course.courseDate || course.date}`);
                    console.log(`Status: ${course.status}`);
                    console.log(`Admin Scheduled Status: ${course.adminScheduledDashStatus}`);
                    console.log(`Admin Instructor Status: ${course.adminInstructorDashStatus}`);
                    console.log(`Instructor: ${course.instructorName || 'Not Assigned'}`);
                    console.log(`Organization: ${course.organization?.name || 'Not Set'}`);
                });
            } catch (error) {
                console.error('Error displaying admin portal records:', error);
            }

            // Display Organization Portal Records
            console.log('\n3. Organization Portal Records:');
            try {
                const currentOrg = JSON.parse(localStorage.getItem('currentOrganization'));
                if (currentOrg) {
                    console.log(`\nCurrent Organization: ${currentOrg.name}`);
                    const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                    const orgCourses = courses.filter(c => c.organization?.id === currentOrg.id);
                    
                    if (orgCourses.length > 0) {
                        console.log('Organization Courses:');
                        orgCourses.forEach(course => {
                            console.log(`\nCourse ID: ${course.id}`);
                            console.log(`Date: ${course.courseDate || course.date}`);
                            console.log(`Status: ${course.organizationStatus}`);
                            console.log(`Instructor: ${course.instructorName || 'Not Assigned'}`);
                        });
                    } else {
                        console.log('No courses found for this organization');
                    }
                } else {
                    console.log('No organization currently logged in');
                }
            } catch (error) {
                console.error('Error displaying organization portal records:', error);
            }
        }

        // Export functions for button clicks
        window.testInstructorAvailability = testInstructorAvailability;
        window.testOrganizationSubmission = testOrganizationSubmission;
        window.testAdminScheduling = testAdminScheduling;
        window.testAdminConfirmation = testAdminConfirmation;
        window.checkCourseStatuses = checkCourseStatuses;
        window.clearConsole = clearConsole;
        window.displayAllPortalRecords = displayAllPortalRecords;

        function checkInstructorStatuses() {
            console.log('=== Checking Instructor Statuses ===');
            try {
                // Get instructors from localStorage
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                if (instructors.length === 0) {
                    console.log('No instructors found in the system.');
                    return;
                }

                instructors.forEach(instructor => {
                    console.log('\nInstructor Details:');
                    console.log('ID:', instructor.id);
                    console.log('Name:', instructor.firstName + ' ' + instructor.lastName);
                    console.log('Email:', instructor.email);
                    console.log('Status:', instructor.status);
                    
                    // Check instructor's availability
                    const availability = JSON.parse(localStorage.getItem('instructorAvailability') || '[]')
                        .filter(a => a.instructorId === instructor.id);
                    console.log('\nAvailability Records:', availability.length);
                    availability.forEach(record => {
                        console.log('- Date:', record.date);
                        console.log('  Available:', record.available);
                        console.log('  Notes:', record.notes || 'No notes');
                    });

                    // Check assigned courses
                    const courses = JSON.parse(localStorage.getItem('courses') || '[]')
                        .filter(course => course.instructorId === instructor.id);
                    console.log('\nAssigned Courses:', courses.length);
                    courses.forEach(course => {
                        console.log('- Course ID:', course.id);
                        console.log('  Date:', course.courseDate);
                        console.log('  Status:', course.status);
                        console.log('  Location:', course.location);
                        console.log('  Students Registered:', course.studentsRegistered);
                    });
                    console.log('\n-------------------');
                });
            } catch (error) {
                console.error('Error checking instructor statuses:', error);
            }
        }

        function clearTestData() {
            console.log('=== Clearing Test Data ===');
            try {
                localStorage.removeItem('instructors');
                localStorage.removeItem('currentInstructor');
                localStorage.removeItem('instructorAvailability');
                localStorage.removeItem('courses');
                console.log('All test data cleared');
                return { success: true, message: 'Test data cleared' };
            } catch (error) {
                console.error('Error clearing test data:', error);
                return { success: false, error: error.message };
            }
        }

        function showCurrentData() {
            console.log('\n=== Current Data in localStorage ===');
            try {
                console.log('\nInstructors:');
                console.log(JSON.stringify(JSON.parse(localStorage.getItem('instructors') || '[]'), null, 2));
                
                console.log('\nOrganizations:');
                console.log(JSON.stringify(JSON.parse(localStorage.getItem('organizations') || '[]'), null, 2));
                
                console.log('\nCourses:');
                console.log(JSON.stringify(JSON.parse(localStorage.getItem('courses') || '[]'), null, 2));
                
                console.log('\nCurrent Instructor:');
                console.log(JSON.stringify(JSON.parse(localStorage.getItem('currentInstructor') || 'null'), null, 2));
                
                console.log('\nCurrent Organization:');
                console.log(JSON.stringify(JSON.parse(localStorage.getItem('currentOrganization') || 'null'), null, 2));
                
                console.log('\nInstructor Availability:');
                console.log(JSON.stringify(JSON.parse(localStorage.getItem('instructorAvailability') || '[]'), null, 2));
            } catch (error) {
                console.error('Error displaying data:', error);
            }
        }

        // Add login simulation functions
        function loginAsInstructor(username) {
            console.log('\n=== Logging in as Instructor ===');
            try {
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                const instructor = instructors.find(i => i.username === username);
                if (instructor) {
                    localStorage.setItem('currentInstructor', JSON.stringify(instructor));
                    console.log('Logged in as instructor:', instructor.username);
                    return { success: true, message: 'Logged in as instructor' };
                } else {
                    console.error('Instructor not found:', username);
                    return { success: false, error: 'Instructor not found' };
                }
            } catch (error) {
                console.error('Error logging in as instructor:', error);
                return { success: false, error: error.message };
            }
        }

        function loginAsOrganization(username) {
            console.log('\n=== Logging in as Organization ===');
            try {
                const organizations = JSON.parse(localStorage.getItem('organizations') || '[]');
                const organization = organizations.find(o => o.username === username);
                if (organization) {
                    localStorage.setItem('currentOrganization', JSON.stringify(organization));
                    console.log('Logged in as organization:', organization.username);
                    return { success: true, message: 'Logged in as organization' };
                } else {
                    console.error('Organization not found:', username);
                    return { success: false, error: 'Organization not found' };
                }
            } catch (error) {
                console.error('Error logging in as organization:', error);
                return { success: false, error: error.message };
            }
        }

        function checkLocalStorageState() {
            console.log('\n=== Current localStorage State ===');
            try {
                const instructors = JSON.parse(localStorage.getItem('instructors') || '[]');
                const organizations = JSON.parse(localStorage.getItem('organizations') || '[]');
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const currentInstructor = JSON.parse(localStorage.getItem('currentInstructor') || 'null');
                const currentOrganization = JSON.parse(localStorage.getItem('currentOrganization') || 'null');
                const instructorAvailability = JSON.parse(localStorage.getItem('instructorAvailability') || '[]');

                console.log('\nInstructors:', JSON.stringify(instructors, null, 2));
                console.log('\nOrganizations:', JSON.stringify(organizations, null, 2));
                console.log('\nCourses:', JSON.stringify(courses, null, 2));
                console.log('\nCurrent Instructor:', JSON.stringify(currentInstructor, null, 2));
                console.log('\nCurrent Organization:', JSON.stringify(currentOrganization, null, 2));
                console.log('\nInstructor Availability:', JSON.stringify(instructorAvailability, null, 2));

                // Add detailed course filtering debug
                if (currentOrganization && courses.length > 0) {
                    console.log('\n=== Course Filtering Debug ===');
                    console.log('Current Organization ID:', currentOrganization.id);
                    courses.forEach(course => {
                        console.log('\nCourse:', course.id);
                        console.log('Course Organization:', course.organization);
                        console.log('Course Organization ID:', course.organization?.id);
                        console.log('Matches current org?', course.organization?.id === currentOrganization.id);
                    });
                }
            } catch (error) {
                console.error('Error checking localStorage state:', error);
            }
        }

        function simulateOrgPortalFiltering() {
            console.log('\n=== Simulating Organization Portal Course Filtering ===');
            try {
                const currentOrganization = JSON.parse(localStorage.getItem('currentOrganization') || 'null');
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                
                if (!currentOrganization) {
                    console.log('No current organization found');
                    return;
                }

                console.log('Current Organization:', currentOrganization);
                console.log('All Courses:', courses);

                // Simulate the filtering logic
                const organizationCourses = courses.filter(course => {
                    const matches = course.organization?.id === currentOrganization.id;
                    console.log(`Course ${course.id}:`, {
                        courseOrgId: course.organization?.id,
                        currentOrgId: currentOrganization.id,
                        matches: matches
                    });
                    return matches;
                });

                console.log('Filtered Courses:', organizationCourses);
            } catch (error) {
                console.error('Error in simulation:', error);
            }
        }
    </script>
</body>
</html> 